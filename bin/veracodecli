#!/usr/bin/env ruby

require 'commander'
require 'veracodecli'

Commander.configure do
  program :name, 'veracodecli'
  program :version, '0.1.0'
  program :description, 'CLI for automating veracode api requests'
  program :help, 'Author', 'Isaiah Thiessen <isaiah.thiessen@telus.com>'

  default_command :scan

  command :scan do |c|
    c.syntax = 'veracodeapi scan --hostname <hostname> --archive-path <archive_path>'
    c.description = 'Submits a scan request to Veracode.'
    c.option '--hostname STRING', String, ''
    c.option '--archive-path STRING', String, ''
    c.action do |_args, options|
      abort 'Missing parameter --hostname' unless options.hostname
      abort 'Missing parameter --archive-path' unless options.archive_path
      VeracodeApiScan.submit_scan options.hostname, options.archive_path
    end
  end

  command :get_prescan_results do |c|
    c.syntax = 'veracodeapi get-prescan-results --app <app_id>'
    c.description = 'Downloads the prescan results from Veracode.'
    c.option '--app STRING', String, ''
    c.action do |_args, options|
      abort 'Missing parameter --app' unless options.app
      VeracodeApiResults.get_prescan_results options.app
    end
  end

  command :get_report do |c|
    c.syntax = 'veracodeapi get-report --app <app_id>'
    c.description = 'Downloads the final scan report from Veracode.'
    c.option '--app STRING', String, ''
    c.action do |args|
      abort 'Missing parameter --app' unless options.app
      VeracodeApiResults.get_scan_report options.app
    end
  end
end
